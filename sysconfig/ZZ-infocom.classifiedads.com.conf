#
# Global Settings
#
# best to keep /etc/httpd/conf/httpd.conf generic.
# we'll put global server stuff here, since this file is easy to back up and restore

# Prevent Apache from divulging version info...
# ... in the headers
ServerTokens Prod
# ... in error text
ServerSignature Off

# The following enables only the seven strongest ciphers:
SSLProtocol +TLSv1 +TLSv1.1 +TLSv1.2
SSLCipherSuite HIGH:MEDIUM

# block access to hidden files
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>
<Directory ~ "/\.">
    Order allow,deny
    Deny from all
</Directory>



# add the php handler for all sites
AddHandler php5-script php htm html rss


# prevent the could-not-determine-the-servers-fully-qualified-domain-name warning
ServerName www.classifiedads.com:80

ExtendedStatus On

#
# Virtual Hosts
#
# If you want to maintain multiple domains/hostnames on your
# machine you can setup VirtualHost containers for them. Most configurations
# use only name-based virtual hosts so the server doesn't need to worry about
# IP addresses. This is indicated by the asterisks in the directives below.
#
# Please see the documentation at
# <URL:http://httpd.apache.org/docs/2.2/vhosts/>
# for further details before you try to setup virtual hosts.
#
# You may use the command line option '-S' to verify your virtual host
# configuration.

# same as combined, but also catches the AdBuy cookie, named AB
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %{AB}C %{LM}n" crazylog

#
# Use name-based virtual hosting.
#
Listen 65.61.105.5:80
Listen 65.61.105.5:443
NameVirtualHost 65.61.105.5:80
NameVirtualHost 65.61.105.5:443

<VirtualHost 65.61.105.5:80>
  ServerAdmin webmaster@classifiedads.com
  DocumentRoot /var/www/html/classifiedads.com
  ServerName classifiedads.com
  ServerAlias www.classifiedads.com
  ServerAlias infocom.classifiedads.com
  CustomLog "|/usr/sbin/cronolog /home/log/cads-%Y-%m-%d.%H.access_log" crazylog
  ErrorLog  /home/log/error_log

  <IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteCond %{REQUEST_URI} ^/(tools|admin)/.*$
    RewriteRule ^(.*)$ https://www.classifiedads.com$1 [R=302,L]
  </IfModule>

  DirectoryIndex index.php
  <Directory /var/www/html/classifiedads.com>
    Options FollowSymLinks
    AllowOverride All
  </Directory>
  <Directory /var/www/html/classifiedads.com/tools>
    deny from all
  </Directory>
  <Directory /var/www/html/classifiedads.com/admin>
    deny from all
  </Directory>
</VirtualHost>

<VirtualHost 65.61.105.5:443>
  ServerAdmin webmaster@classifiedads.com
  DocumentRoot /var/www/html/classifiedads.com
  ServerName classifiedads.com
  ServerAlias www.classifiedads.com
  ServerAlias infocom.classifiedads.com
  CustomLog "|/usr/sbin/cronolog /var/log/httpd/classifiedads/cads-%Y-%m-%d.%H.access_log" crazylog
  ErrorLog  /var/log/httpd/classifiedads/classifiedads.com.error_log

  <IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteCond %{REQUEST_URI} ^/$
    RewriteRule ^(.*)$ http://www.classifiedads.com [R=302,L]
  </IfModule>

  DirectoryIndex index.php
  <Directory /var/www/html/classifiedads.com>
    Options FollowSymLinks
    AllowOverride All
  </Directory>
  <Directory /var/www/html/classifiedads.com/tools>
    Order allow,deny
    allow from all
    AuthName TOOLS
    AuthType Basic
    require valid-user
    AuthUserFile /var/www/html/classifiedads.com/tools/.htpasswd
    Options FollowSymLinks
    AllowOverride All
    php_value upload_max_filesize 12M
  </Directory>
  <Directory /var/www/html/classifiedads.com/admin>
    Order allow,deny
    allow from all
    AuthName ADMIN
    AuthType Basic
    require valid-user
    AuthUserFile /var/www/html/classifiedads.com/admin/.htpasswd
    Options FollowSymLinks
    AllowOverride All
  </Directory>
  SSLEngine On
  SSLCertificateFile /etc/pki/tls/certs/classifiedads.com.crt
  SSLCertificateKeyFile /etc/pki/tls/private/classifiedads.key
  SSLCertificateChainFile /etc/pki/tls/certs/sf_bundle.crt
  #SSLCertificateFile /etc/pki/tls/certs/cads.crt
  #SSLCertificateKeyFile /etc/pki/tls/certs/cads.key
</VirtualHost>
